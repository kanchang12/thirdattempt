<!DOCTYPE html>
<html>
<head>
    <title>OpenAI Chat API Example</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>OpenAI Chat API Example</h2>
    
    <!-- File upload form -->
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="fileInput">Upload CSV file:</label>
        <input type="file" id="fileInput" accept=".csv" name="csv_file"><br><br>
        <label for="user_input">User Input:</label><br>
        <textarea id="user_input" name="user_input" rows="4" cols="50"></textarea><br><br>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>
    
    <div id="responseContainer"></div>

    <script>
        function submitForm() {
            // Get user input
            var userInput = document.getElementById('user_input').value;

            // Get uploaded CSV file
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];

            if (!file) {
                alert('Please select a CSV file.');
                return;
            }

            // Read the file contents
            var reader = new FileReader();
            reader.onload = function(event) {
                var csvContent = event.target.result;

                // Append user input to the CSV content
                var modifiedCsvContent = csvContent + '\n' + userInput;

                // Prepare the request payload
                var formData = new FormData();
                formData.append('csv_content', modifiedCsvContent);

                // Send POST request to Flask backend
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/submit', true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                // Define callback function to handle response
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            var response = JSON.parse(xhr.responseText);
                            document.getElementById('responseContainer').innerHTML = '<p>' + response.response + '</p>';
                        } else {
                            console.error('Error:', xhr.statusText);
                            document.getElementById('responseContainer').innerHTML = '<p>Error: ' + xhr.statusText + '</p>';
                        }
                    }
                };

                // Send the form data
                xhr.send(formData);
            };

            // Read the file as text
            reader.readAsText(file);
        }
    </script>
</body>
</html>
